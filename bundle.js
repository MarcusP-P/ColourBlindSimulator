(()=>{"use strict";var t={773:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix=void 0;class i{}e.Matrix=i,i.transpose=t=>{var e;const i=t.length||0,a=null===(e=t[0])||void 0===e?void 0:e.length,r=s();for(let e=0;e<i;e++)for(let i=0;i<a;i++)r[i][e]=t[e][i];return r},i.inv=t=>{const e=s(),[[i,a,r],[o,n,h],[_,u,l]]=t,c=i*n*l-i*h*u-a*o*l+a*h*_+r*o*u-r*n*_;if(0===c)throw new Error("Matrix not invertible");const R=1/c;return e[0][0]=R*(n*l-h*u),e[0][1]=R*(r*u-a*l),e[0][2]=R*(a*h-r*n),e[1][0]=R*(h*_-o*l),e[1][1]=R*(i*l-r*_),e[1][2]=R*(r*o-i*h),e[2][0]=R*(o*u-n*_),e[2][1]=R*(a*_-i*u),e[2][2]=R*(i*n-a*o),e},i.multiply_3x3_times_triple=(t,e)=>{const[[i,s,a],[r,o,n],[h,_,u]]=t,[l,c,R]=e;return[i*l+s*c+a*R,r*l+o*c+n*R,h*l+_*c+u*R]},i.multiply_triple_times_3x3=(t,e)=>{const[i,s,a]=t,[[r,o,n],[h,_,u],[l,c,R]]=e;return[r*i+h*s+l*a,o*i+_*s+c*a,n*i+u*s+R*a]},i.multiply_3x3_times_3x3=(t,e)=>{const[[i,s,a],[r,o,n],[h,_,u]]=t,[[l,c,R],[L,b,v],[x,M,B]]=e;return[[i*l+s*L+a*x,i*c+s*b+a*M,i*R+s*v+a*B],[r*l+o*L+n*x,r*c+o*b+n*M,r*R+o*v+n*B],[h*l+_*L+u*x,h*c+_*b+u*M,h*R+_*v+u*B]]};const s=()=>[[1,0,0],[0,1,0],[0,0,1]]},564:(t,e,i)=>{e.N=void 0;const s=i(773);e.N=class{constructor({RefWhite:t="D50",RgbModel:e="sRGB",GammaModel:i="sRGB",Adaptation:s="Bradford"}={}){this.RefWhite="D50",this.RgbModel="sRGB",this.GammaModel="sRGB",this.Adaptation="Bradford",this.kE=216/24389,this.kK=24389/27,this.RefWhite=t,this.RgbModel=e,this.GammaModel=i,this.Adaptation=s}get Mtx_RefWhite(){switch(this.RefWhite){case"A":return[1.0985,1,.35585];case"B":return[.99072,1,.85223];case"C":return[.98074,1,1.18232];case"D50":return[.96422,1,.82521];case"D55":return[.95682,1,.92149];case"D65":return[.95047,1,1.0888];case"D75":return[.94972,1,1.22638];default:return[1,1,1];case"F2":return[.99186,1,.67393];case"F7":return[.95041,1,1.08747];case"F11":return[1.00962,1,.6435]}}get Mtx_RefWhiteRGB(){switch(this.RgbModel){case"Adobe RGB (1998)":case"AppleRGB":case"Bruce RGB":case"PAL/SECAM RGB":case"SMPTE-C RGB":case"sRGB":return[.95047,1,1.08883];case"Best RGB":case"Beta RGB":case"ColorMatch RGB":case"Don RGB 4":case"ECI RGB v2":case"Ekta Space PS5":case"ProPhoto RGB":case"Wide Gamut RGB":return[.96422,1,.82521];case"CIE RGB":return[1,1,1];case"NTSC RGB":return[.98074,1,1.18232]}}get GammaRGB(){switch(this.RgbModel){case"Adobe RGB (1998)":case"Best RGB":case"Beta RGB":case"Bruce RGB":case"CIE RGB":case"Don RGB 4":case"Ekta Space PS5":case"NTSC RGB":case"PAL/SECAM RGB":case"SMPTE-C RGB":case"Wide Gamut RGB":return{value:2.2,index:2};case"AppleRGB":case"ProPhoto RGB":return{value:1.8,index:1};case"ColorMatch RGB":return{value:1.8,index:2};case"ECI RGB v2":return{value:0,index:4};case"sRGB":return{value:-2.2,index:3}}}get Gamma(){switch(this.GammaModel.toString()){default:return 1;case"1.8":return 1.8;case"2.2":return 2.2;case"sRGB":return-2.2;case"L*":return 0}}get Mtx_RGB2XYZ(){let t,e,i,a,r,o;switch(this.RgbModel){case"Adobe RGB (1998)":[t,e,i,a,r,o]=[.64,.33,.21,.71,.15,.06];break;case"AppleRGB":[t,e,i,a,r,o]=[.625,.34,.28,.595,.155,.07];break;case"Best RGB":[t,e,i,a,r,o]=[.7347,.2653,.215,.775,.13,.035];break;case"Beta RGB":[t,e,i,a,r,o]=[.6888,.3112,.1986,.7551,.1265,.0352];break;case"Bruce RGB":[t,e,i,a,r,o]=[.64,.33,.28,.65,.15,.06];break;case"CIE RGB":[t,e,i,a,r,o]=[.735,.265,.274,.717,.167,.009];break;case"ColorMatch RGB":[t,e,i,a,r,o]=[.63,.34,.295,.605,.15,.075];break;case"Don RGB 4":[t,e,i,a,r,o]=[.696,.3,.215,.765,.13,.035];break;case"ECI RGB v2":case"NTSC RGB":[t,e,i,a,r,o]=[.67,.33,.21,.71,.14,.08];break;case"Ekta Space PS5":[t,e,i,a,r,o]=[.695,.305,.26,.7,.11,.005];break;case"PAL/SECAM RGB":[t,e,i,a,r,o]=[.64,.33,.29,.6,.15,.06];break;case"ProPhoto RGB":[t,e,i,a,r,o]=[.7347,.2653,.1596,.8404,.0366,1e-4];break;case"SMPTE-C RGB":[t,e,i,a,r,o]=[.63,.34,.31,.595,.155,.07];break;case"sRGB":[t,e,i,a,r,o]=[.64,.33,.3,.6,.15,.06];break;case"Wide Gamut RGB":[t,e,i,a,r,o]=[.735,.265,.115,.826,.157,.018]}let n=t/e,h=(1-t-e)/e,_=i/a,u=(1-i-a)/a,l=r/o,c=(1-r-o)/o,R=this.Mtx_RefWhiteRGB,L=R[0],b=R[1],v=R[2],[x,M,B]=s.Matrix.multiply_3x3_times_triple(s.Matrix.inv([[n,_,l],[1,1,1],[h,u,c]]),[L,b,v]);return s.Matrix.transpose([[x*n,M*_,B*l],[1*x,1*M,1*B],[x*h,M*u,B*c]])}get MtxAdp(){switch(this.Adaptation){case"Bradford":return[[.8951,-.7502,.0389],[.2664,1.7135,-.0685],[-.1614,.0367,1.0296]];case"von Kries":return[[.40024,-.2263,0],[.7076,1.16532,0],[-.08081,.0457,.91822]];case"XYZ Scaling":case"None":return[[1,0,0],[0,1,0],[0,0,1]]}}compand(t){let e=this.Gamma;if(e>0)return t>=0?Math.pow(t,1/e):-Math.pow(-t,1/e);if(e<0){let e=1;return t<0&&(e=-1,t=-t),e*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}{let e=1;return t<0&&(e=-1,t=-t),e*(t<=216/24389?24389*t/2700:1.16*Math.pow(t,1/3)-.16)}}inverse_compand(t){let e=this.Gamma;if(e>0)return t>=0?Math.pow(t,e):-Math.pow(-t,e);if(e<0){let e=1;return t<0&&(e=-1,t=-t),e*(t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4))}{let e=1;return t<0&&(e=-1,t=-t),e*(t<=.08?2700*t/24389:(((1e6*t+48e4)*t+76800)*t+4096)/1560896)}}XYZ_to_RGB(t){let e=t;if("None"!=this.Adaptation){let[i,a,r]=s.Matrix.multiply_triple_times_3x3(this.Mtx_RefWhite,this.MtxAdp),[o,n,h]=s.Matrix.multiply_triple_times_3x3(this.Mtx_RefWhiteRGB,this.MtxAdp);e=s.Matrix.multiply_triple_times_3x3(t,s.Matrix.multiply_3x3_times_3x3(this.MtxAdp,s.Matrix.multiply_3x3_times_3x3([[o/i,0,0],[0,n/a,0],[0,0,h/r]],s.Matrix.inv(this.MtxAdp))))}return s.Matrix.multiply_triple_times_3x3(e,s.Matrix.inv(this.Mtx_RGB2XYZ)).map((t=>255*this.compand(t)))}RGB_to_XYZ(t){t=t.map((t=>this.inverse_compand(t/255)));let e=s.Matrix.multiply_triple_times_3x3(t,this.Mtx_RGB2XYZ);if("None"!=this.Adaptation){let[t,i,a]=s.Matrix.multiply_triple_times_3x3(this.Mtx_RefWhiteRGB,this.MtxAdp),[r,o,n]=s.Matrix.multiply_triple_times_3x3(this.Mtx_RefWhite,this.MtxAdp);return s.Matrix.multiply_triple_times_3x3(e,s.Matrix.multiply_3x3_times_3x3(this.MtxAdp,s.Matrix.multiply_3x3_times_3x3([[r/t,0,0],[0,o/i,0],[0,0,n/a]],s.Matrix.inv(this.MtxAdp))))}return e}Lab_to_XYZ(t){let e=t[0],i=(e+16)/116,s=t[1]/500+i,a=i-t[2]/200,r=Math.pow(s,3)>this.kE?Math.pow(s,3):(116*s-16)/this.kK,o=e>this.kK*this.kE?Math.pow((e+16)/116,3):e/this.kK,n=Math.pow(a,3)>this.kE?Math.pow(a,3):(116*a-16)/this.kK,h=this.Mtx_RefWhite;return[r*h[0],o*h[1],n*h[2]]}XYZ_to_Lab(t){let e=t[0],i=t[1],s=t[2],a=this.Mtx_RefWhite,r=e/a[0],o=i/a[1],n=s/a[2],h=r>this.kE?Math.pow(r,1/3):(this.kK*r+16)/116,_=o>this.kE?Math.pow(o,1/3):(this.kK*o+16)/116;return[116*_-16,500*(h-_),200*(_-(n>this.kE?Math.pow(n,1/3):(this.kK*n+16)/116))]}Lab_to_RGB(t){return this.XYZ_to_RGB(this.Lab_to_XYZ(t))}RGB_to_Lab(t){return this.XYZ_to_Lab(this.RGB_to_XYZ(t))}xyY_to_XYZ(t){let[e,i,s]=t;return i<1e-6?[0,0,0]:[e*s/i,s,(1-e-i)*s/i]}XYZ_to_xyY(t){let[e,i,s]=t,a=e+i+s;if(a>0)return[e/a,i/a,i];{let[t,e,s]=this.Mtx_RefWhite,a=t+e+s;return[t/a,e/a,i]}}Lab_to_LCHab(t){let[e,i,s]=t,a=180/Math.PI*Math.atan2(s,i);return[e,Math.sqrt(Math.pow(i,2)+Math.pow(s,2)),a+(a>=0?0:360)]}LCHab_to_Lab(t){let[e,i,s]=t;return[e,i*Math.cos(s*Math.PI/180),i*Math.sin(s*Math.PI/180)]}XYZ_to_LCHab(t){return this.Lab_to_LCHab(this.XYZ_to_Lab(t))}XYZ_to_Luv(t){let[e,i,s]=t,a=this.Mtx_RefWhite,r=a[0],o=a[1],n=a[2],h=e+15*i+3*s,_=h>0?4*e/h:0,u=h>0?9*i/h:0,l=4*r/(r+15*o+3*n),c=9*o/(r+15*o+3*n),R=i/o,L=R>this.kE?116*Math.pow(R,1/3)-16:this.kK*R;return[L,13*L*(_-l),13*L*(u-c)]}XYZ_to_LCHuv(t){return this.Luv_to_LCHuv(this.XYZ_to_Luv(t))}Luv_to_LCHuv(t){let[e,i,s]=t,a=180/Math.PI*Math.atan2(s,i);return[e,Math.sqrt(Math.pow(i,2)+Math.pow(s,2)),a+(a>=0?0:360)]}xyY_to_Lab(t){return this.XYZ_to_Lab(this.xyY_to_XYZ(t))}xyY_to_LCHab(t){return this.Lab_to_LCHab(this.XYZ_to_Lab(this.xyY_to_XYZ(t)))}xyY_to_Luv(t){return this.XYZ_to_Luv(this.xyY_to_XYZ(t))}xyY_to_LCHuv(t){return this.Luv_to_LCHuv(this.XYZ_to_Luv(this.xyY_to_XYZ(t)))}xyY_to_RGB(t){return this.XYZ_to_RGB(this.xyY_to_XYZ(t))}Lab_to_xyY(t){return this.XYZ_to_xyY(this.Lab_to_XYZ(t))}Lab_to_Luv(t){return this.XYZ_to_Luv(this.Lab_to_XYZ(t))}Lab_to_LCHuv(t){return this.Luv_to_LCHuv(this.Lab_to_Luv(t))}LCHab_to_XYZ(t){return this.Lab_to_XYZ(this.LCHab_to_Lab(t))}LCHab_to_xyY(t){return this.XYZ_to_xyY(this.Lab_to_XYZ(this.LCHab_to_Lab(t)))}LCHab_to_Luv(t){return this.XYZ_to_Luv(this.Lab_to_XYZ(this.LCHab_to_Lab(t)))}LCHab_to_LCHuv(t){return this.Luv_to_LCHuv(this.LCHab_to_Luv(t))}LCHab_to_RGB(t){return this.XYZ_to_RGB(this.LCHab_to_XYZ(t))}Luv_to_XYZ(t){let[e,i,s]=t,a=e>this.kK*this.kE?Math.pow((e+16)/116,3):e/this.kK,r=this.Mtx_RefWhite,o=r[0],n=r[1],h=o+15*n+3*r[2],_=-5*a,u=1/3*(52*e/(i+13*e*(4*o/h))-1),l=(a*(39*e/(s+13*e*(9*n/h))-5)-_)/(u- -1/3);return[l,a,l*u+_]}Luv_to_xyY(t){return this.XYZ_to_xyY(this.Luv_to_XYZ(t))}Luv_to_Lab(t){return this.XYZ_to_Lab(this.Luv_to_XYZ(t))}Luv_to_LCHab(t){return this.Lab_to_LCHab(this.Luv_to_Lab(t))}Luv_to_RGB(t){return this.XYZ_to_RGB(this.Luv_to_XYZ(t))}LCHuv_to_Luv(t){let[e,i,s]=t;return[e,i*Math.cos(s*Math.PI/180),i*Math.sin(s*Math.PI/180)]}LCHuv_to_XYZ(t){return this.Luv_to_XYZ(this.LCHuv_to_Luv(t))}LCHuv_to_xyY(t){return this.XYZ_to_xyY(this.LCHuv_to_XYZ(t))}LCHuv_to_Lab(t){return this.XYZ_to_Lab(this.LCHuv_to_XYZ(t))}LCHuv_to_LCHab(t){return this.Lab_to_LCHab(this.LCHuv_to_Lab(t))}LCHuv_to_RGB(t){return this.XYZ_to_RGB(this.LCHuv_to_XYZ(t))}RGB_to_xyY(t){return this.XYZ_to_xyY(this.RGB_to_XYZ(t))}RGB_to_LCHab(t){return this.Lab_to_LCHab(this.RGB_to_Lab(t))}RGB_to_Luv(t){return this.XYZ_to_Luv(this.RGB_to_XYZ(t))}RGB_to_LCHuv(t){return this.Luv_to_LCHuv(this.RGB_to_Luv(t))}}}},e={};function i(s){var a=e[s];if(void 0!==a)return a.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}(()=>{class t{constructor(t){this.calibrationCanvas=t,this.calibrationCanvas.width=408,this.calibrationCanvas.height=408,this.calibrationCanvas.style.backgroundColor="#000000";const e=this.calibrationCanvas.getContext("2d");if(null===e)throw new Error("Can't get context");this.context=e,this.context.globalCompositeOperation="source-over"}initialiseCanvas(e){for(let i=0;i<=50;i++)for(let s=0;s<=50;s++)t.drawCircle(i,s,e.getColourByColumnRow(i,s),this.context)}static drawCircle(t,e,i,s){const a=8*t,r=8*e;s.fillStyle=`rgb(${i[0]},${i[1]},${i[2]})`,s.fillRect(a+3,r+2,1,1),s.fillRect(a+4,r+2,1,1),s.fillRect(a+2,r+3,1,1),s.fillRect(a+3,r+3,1,1),s.fillRect(a+4,r+3,1,1),s.fillRect(a+5,r+3,1,1),s.fillRect(a+2,r+4,1,1),s.fillRect(a+3,r+4,1,1),s.fillRect(a+4,r+4,1,1),s.fillRect(a+5,r+4,1,1),s.fillRect(a+3,r+5,1,1),s.fillRect(a+4,r+5,1,1)}}class e{constructor(){this.grid=[];for(let t=0;t<51;t++){const t=[];for(let e=0;e<51;e++)t.push([0,0,0]);this.grid.push(t)}}setColourByXY(t,e,i){if(t<-25||t>25)throw new Error("x must be between -25 and 25 inclusive");if(e<-25||e>25)throw new Error("y must be between -25 and 25 inclusive");const s=t+25,a=e+25;this.grid[s][a]=i}getColourByXY(t,e){if(t<-25||t>25)throw new Error("x must be between -25 and 25 inclusive");if(e<-25||e>25)throw new Error("y must be between -25 and 25 inclusive");const i=t+25,s=e+25;return this.grid[i][s]}setColourByColumnRow(t,e,i){if(t<0||t>50)throw new Error("column must be between 0 and 50 inclusive");if(e<0||e>50)throw new Error("row must be between 0 and 50 inclusive");const s=50-e;this.grid[t][s]=i}getColourByColumnRow(t,e){if(t<0||t>51)throw new Error("column must be between 0 and 51 inclusive");if(e<0||e>51)throw new Error("row must be between 0 and 51 inclusive");const i=50-e;return this.grid[t][i]}}var s,a=i(564);!function(t){t[t.North=0]="North",t[t.NorthEast=1]="NorthEast",t[t.East=2]="East",t[t.SouthEast=3]="SouthEast",t[t.South=4]="South",t[t.SouthWest=5]="SouthWest",t[t.West=6]="West",t[t.NorthWest=7]="NorthWest"}(s||(s={}));const r=document.querySelector("#canvasHost");if(null===r)throw new Error("Can't find canvashost");new class{constructor(e,i,a){this.parentDiv=e,this.container=document.createElement("div"),this.parentDiv.appendChild(this.container),this.container.style.background="#000000",this.container.style.width="100%",this.container.style.height="100%",this.container.style.alignItems="center",this.container.style.justifyContent="center",this.container.style.display="flex",this.canvas=document.createElement("canvas"),this.canvas.style.margin="auto",this.container.appendChild(this.canvas),this.calibrationImage=new t(this.canvas),this.baseLuv=i,this.testLuv=a,this.lastTime=0;let r=Math.random();for(;1===r;)r=Math.random();this.quadrant=r<.125?s.North:r<.25?s.NorthEast:r<.375?s.East:r<.5?s.SouthEast:r<.625?s.South:r<.75?s.SouthWest:r<.875?s.West:s.NorthWest,this.animationRunning=!1}async getCalibrationResult(){return this.animationRunning=!0,window.requestAnimationFrame((t=>{this.animate(t)})),new Promise((t=>{this.canvas.addEventListener("click",(e=>{this.animationRunning=!1,console.log(`OffsetX=${e.offsetX}, OffsetY=${e.offsetY}`),t(!1)}),{once:!0})}))}animate(t){if(this.animationRunning){if(t-this.lastTime>50){const i=function(t,i,r){const o=new e,n=new a.N;n.RefWhite="D65";const h=.414213562373095,_=2.414213562373095;let u,l,c,R;switch(r){case s.North:u=-1*_,l=_,c=1,R=-1;break;case s.NorthEast:u=_,l=h,c=1,R=-1;break;case s.East:u=h,l=-1*h,c=1,R=1;break;case s.SouthEast:u=-1*h,l=-1*_,c=-1,R=1;break;case s.South:u=-1*_,l=_,c=-1,R=1;break;case s.SouthWest:u=_,l=h,c=-1,R=1;break;case s.West:u=h,l=-1*h,c=-1,R=-1;break;case s.NorthWest:u=-1*h,l=-1*_,c=1,R=-1;break;default:throw new Error("Invalid quadrant")}for(let e=-25;e<=25;e++)for(let s=-25;s<=25;s++){const a=Math.sqrt(e**2+s**2),r=s/u,h=s/l,_=.5,L=Math.random()*_-_/2+1;a>13.5&&a<=20.5&&!(e*c>r*c&&e*R>h*R)?o.setColourByXY(e,s,n.Luv_to_RGB([i[0]*L,i[1],i[2]])):o.setColourByXY(e,s,n.Luv_to_RGB([t[0]*L,t[1],t[2]]))}return o}(this.baseLuv,this.testLuv,this.quadrant);this.calibrationImage.initialiseCanvas(i),this.lastTime=t}window.requestAnimationFrame((t=>{this.animate(t)}))}}}(r,[50,0,0],[50,-11.5396,-121.9686]).getCalibrationResult().then((t=>{console.log(t?"true":"false")})),console.log("foo")})()})();